"use strict";(()=>{var e={};e.id=9419,e.ids=[9419],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},17429:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var a={};t.r(a),t.d(a,{GET:()=>l});var n=t(70101),i=t(90796),o=t(83055),s=t(68364),u=t(98641);async function l(e,{params:r}){let t=await (0,u.kF)();if(t.error)return(0,u.iv)(t.error,t.status);try{let e=parseInt(r.raffleId);if(isNaN(e))return(0,u.iv)("Invalid raffle ID",400);if(!await s._.raffle.findUnique({where:{id:e}}))return(0,u.iv)("Raffle not found",404);let t=(await s._.ticket.findMany({where:{raffleId:e,paymentStatus:"confirmed"},orderBy:{ticketNumber:"asc"}})).map(e=>({id:e.id,ticketNumber:e.ticketNumber,buyerName:e.buyerName,buyerEmail:e.buyerEmail,buyerPhone:e.buyerPhone,paymentStatus:e.paymentStatus,amountPaid:Number(e.amountPaid),purchasedAt:e.purchasedAt,confirmedAt:e.confirmedAt}));return(0,u.Yh)({tickets:t,totalTickets:t.length})}catch(e){return console.error("Error fetching raffle tickets:",e),(0,u.iv)("Internal server error",500)}}let c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/raffles/[raffleId]/tickets/route",pathname:"/api/admin/raffles/[raffleId]/tickets",filename:"route",bundlePath:"app/api/admin/raffles/[raffleId]/tickets/route"},resolvedPagePath:"C:\\Users\\BIENV\\Downloads\\auth-system\\app\\api\\admin\\raffles\\[raffleId]\\tickets\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:f}=c,m="/api/admin/raffles/[raffleId]/tickets/route";function y(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}},98641:(e,r,t)=>{t.d(r,{Yh:()=>s,iv:()=>u,kF:()=>o});var a=t(8967),n=t(13778),i=t(12903);async function o(){let e=await (0,a.getServerSession)(n.L);return e?"admin"!==e.user.role?{error:"Acceso denegado",status:403}:{session:e}:{error:"No autorizado",status:401}}function s(e,r=200){return i.NextResponse.json(e,{status:r})}function u(e,r=400){return i.NextResponse.json({error:e},{status:r})}},13778:(e,r,t)=>{t.d(r,{L:()=>s});var a=t(76330),n=t(44471),i=t(57125),o=t(68364);let s={adapter:(0,a.N)(o._),secret:process.env.NEXTAUTH_SECRET,providers:[(0,n.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email y contrase\xf1a son requeridos");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email))throw Error("Formato de email inv\xe1lido");let r=await o._.user.findUnique({where:{email:e.email.toLowerCase()},select:{id:!0,email:!0,name:!0,password:!0,role:!0}});if(!r)throw Error("No existe una cuenta con este email");if(!r.password)throw Error("Esta cuenta no tiene contrase\xf1a configurada");if(!await i.ZP.compare(e.password,r.password))throw Error("Contrase\xf1a incorrecta");return{id:r.id,email:r.email,name:r.name,role:r.role}}})],session:{strategy:"jwt"},pages:{signIn:"/login"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id,e.user.role=r.role),e)}}},68364:(e,r,t)=>{t.d(r,{_:()=>n});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient},31329:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},8967:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0});var a={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return i.default}});var n=t(31329);Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))});var i=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o(void 0);if(t&&t.has(e))return t.get(e);var a={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&({}).hasOwnProperty.call(e,i)){var s=n?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(a,i,s):a[i]=e[i]}return a.default=e,t&&t.set(e,a),a}(t(21585));function o(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(o=function(e){return e?t:r})(e)}Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}}))})}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[9780,332,7125,91],()=>t(17429));module.exports=a})();